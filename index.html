<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QRIS Professional Tools</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/jsqr@1.4.0/dist/jsQR.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.1/build/qrcode.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Firebase App (the core Firebase SDK) -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <!-- Firebase Authentication -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <!-- Firebase Realtime Database -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <!-- Firebase Storage -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-storage.js"></script>
    <style>
        :root {
            --primary: #2563eb;
            --primary-dark: #1e40af;
            --primary-light: #3b82f6;
            --secondary: #0ea5e9;
            --accent: #06b6d4;
            --success: #10b981;
            --error: #ef4444;
            --warning: #f59e0b;
            --info: #8b5cf6;
            
            --bg-primary: #f8fafc;
            --bg-secondary: #ffffff;
            --bg-tertiary: #f1f5f9;
            
            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --text-muted: #94a3b8;
            
            --border-color: #e2e8f0;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            
            --card-radius: 16px;
            --element-radius: 12px;
            --button-radius: 10px;
            
            --transition: all 0.3s ease;
        }

        [data-theme="dark"] {
            --bg-primary: #0f172a;
            --bg-secondary: #1e293b;
            --bg-tertiary: #334155;
            
            --text-primary: #f1f5f9;
            --text-secondary: #cbd5e1;
            --text-muted: #94a3b8;
            
            --border-color: #334155;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3), 0 2px 4px -1px rgba(0, 0, 0, 0.2);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.3), 0 4px 6px -2px rgba(0, 0, 0, 0.2);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', 'Poppins', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            line-height: 1.6;
            transition: var(--transition);
        }
        
        /* Loading Screen */
        #loadingScreen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            transition: opacity 0.5s ease;
        }
        
        .loader {
            width: 60px;
            height: 60px;
            border: 5px solid rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            border-top: 5px solid white;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .loading-text {
            color: white;
            font-size: 18px;
            font-weight: 500;
        }
        
        /* Auth Modal */
        #authModal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            backdrop-filter: blur(5px);
        }
        
        .auth-container {
            background: var(--bg-secondary);
            border-radius: var(--card-radius);
            padding: 30px;
            width: 90%;
            max-width: 400px;
            box-shadow: var(--shadow-lg);
            text-align: center;
        }
        
        .auth-logo {
            margin-bottom: 20px;
        }
        
        .auth-title {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 10px;
            color: var(--text-primary);
        }
        
        .auth-subtitle {
            color: var(--text-secondary);
            margin-bottom: 25px;
            font-size: 14px;
        }
        
        .auth-input {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid var(--border-color);
            border-radius: var(--element-radius);
            margin-bottom: 15px;
            font-size: 15px;
            background: var(--bg-tertiary);
            color: var(--text-primary);
            transition: var(--transition);
        }
        
        .auth-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.2);
        }
        
        .auth-button {
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            border: none;
            border-radius: var(--element-radius);
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            margin-top: 10px;
        }
        
        .auth-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(37, 99, 235, 0.25);
        }
        
        /* Layout */
        .app-container {
            display: flex;
            min-height: 100vh;
        }
        
        /* Sidebar/Navigation */
        .sidebar {
            width: 260px;
            background: var(--bg-secondary);
            border-right: 1px solid var(--border-color);
            padding: 20px 0;
            display: flex;
            flex-direction: column;
            box-shadow: var(--shadow);
            transition: var(--transition);
            z-index: 100;
        }
        
        .sidebar-header {
            padding: 0 20px 20px;
            border-bottom: 1px solid var(--border-color);
            margin-bottom: 20px;
        }
        
        .sidebar-logo {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 25px;
        }
        
        .logo-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 18px;
        }
        
        .logo-text {
            font-size: 20px;
            font-weight: 700;
            background: linear-gradient(to right, var(--primary), var(--accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .user-profile {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 20px;
            cursor: pointer;
        }
        
        .user-avatar {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            object-fit: cover;
            background: var(--bg-tertiary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            color: var(--text-secondary);
        }
        
        .user-info {
            flex: 1;
        }
        
        .user-name {
            font-size: 15px;
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .user-role {
            font-size: 12px;
            color: var(--text-secondary);
        }
        
        .nav-menu {
            flex: 1;
            padding: 0 10px;
        }
        
        .nav-item {
            display: flex;
            align-items: center;
            padding: 12px 15px;
            border-radius: var(--element-radius);
            margin-bottom: 5px;
            cursor: pointer;
            transition: var(--transition);
            color: var(--text-secondary);
            font-weight: 500;
        }
        
        .nav-item:hover {
            background: var(--bg-tertiary);
            color: var(--primary);
        }
        
        .nav-item.active {
            background: rgba(37, 99, 235, 0.1);
            color: var(--primary);
        }
        
        .nav-icon {
            margin-right: 12px;
            font-size: 18px;
            width: 24px;
            text-align: center;
        }
        
        .nav-text {
            flex: 1;
        }
        
        .nav-badge {
            background: var(--primary);
            color: white;
            font-size: 11px;
            padding: 3px 8px;
            border-radius: 20px;
            font-weight: 600;
        }
        
        .sidebar-footer {
            padding: 15px 20px 0;
            border-top: 1px solid var(--border-color);
            margin-top: auto;
        }
        
        .theme-switcher {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px 0;
            color: var(--text-secondary);
        }
        
        .theme-label {
            font-size: 14px;
        }
        
        .switch {
            position: relative;
            display: inline-block;
            width: 48px;
            height: 24px;
        }
        
        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--bg-tertiary);
            transition: .4s;
            border-radius: 34px;
        }
        
        .slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        
        input:checked + .slider {
            background-color: var(--primary);
        }
        
        input:checked + .slider:before {
            transform: translateX(24px);
        }
        
        /* Main Content */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        .top-header {
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border-color);
            padding: 15px 25px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: var(--shadow);
            z-index: 10;
        }
        
        .search-bar {
            display: flex;
            align-items: center;
            background: var(--bg-tertiary);
            border-radius: var(--element-radius);
            padding: 8px 15px;
            width: 300px;
        }
        
        .search-icon {
            color: var(--text-muted);
            margin-right: 10px;
        }
        
        .search-input {
            border: none;
            background: transparent;
            color: var(--text-primary);
            width: 100%;
            font-size: 14px;
        }
        
        .search-input:focus {
            outline: none;
        }
        
        .header-actions {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .header-action {
            width: 38px;
            height: 38px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--bg-tertiary);
            color: var(--text-secondary);
            cursor: pointer;
            transition: var(--transition);
            position: relative;
        }
        
        .header-action:hover {
            background: var(--primary);
            color: white;
        }
        
        .notification-badge {
            position: absolute;
            top: -3px;
            right: -3px;
            background: var(--error);
            color: white;
            font-size: 10px;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
        }
        
        .content-area {
            flex: 1;
            padding: 25px;
            overflow-y: auto;
        }
        
        .page-title {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 5px;
            color: var(--text-primary);
        }
        
        .page-subtitle {
            color: var(--text-secondary);
            margin-bottom: 25px;
            font-size: 14px;
        }
        
        /* Dashboard */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }
        
        .stat-card {
            background: var(--bg-secondary);
            border-radius: var(--card-radius);
            padding: 20px;
            box-shadow: var(--shadow);
            transition: var(--transition);
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }
        
        .stat-icon {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            margin-bottom: 15px;
        }
        
        .stat-icon.blue {
            background: rgba(37, 99, 235, 0.1);
            color: var(--primary);
        }
        
        .stat-icon.green {
            background: rgba(16, 185, 129, 0.1);
            color: var(--success);
        }
        
        .stat-icon.purple {
            background: rgba(139, 92, 246, 0.1);
            color: var(--info);
        }
        
        .stat-icon.orange {
            background: rgba(245, 158, 11, 0.1);
            color: var(--warning);
        }
        
        .stat-value {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 5px;
            color: var(--text-primary);
        }
        
        .stat-label {
            color: var(--text-secondary);
            font-size: 14px;
        }
        
        .charts-container {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
            margin-bottom: 25px;
        }
        
        .chart-card {
            background: var(--bg-secondary);
            border-radius: var(--card-radius);
            padding: 20px;
            box-shadow: var(--shadow);
        }
        
        .chart-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
        }
        
        .chart-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .chart-actions {
            display: flex;
            gap: 10px;
        }
        
        .chart-action {
            width: 30px;
            height: 30px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--bg-tertiary);
            color: var(--text-secondary);
            cursor: pointer;
            transition: var(--transition);
        }
        
        .chart-action:hover {
            background: var(--primary);
            color: white;
        }
        
        .recent-activity {
            background: var(--bg-secondary);
            border-radius: var(--card-radius);
            padding: 20px;
            box-shadow: var(--shadow);
        }
        
        .activity-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
        }
        
        .activity-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .view-all {
            color: var(--primary);
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
        }
        
        .activity-list {
            list-style: none;
        }
        
        .activity-item {
            display: flex;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid var(--border-color);
        }
        
        .activity-item:last-child {
            border-bottom: none;
        }
        
        .activity-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            font-size: 16px;
        }
        
        .activity-icon.success {
            background: rgba(16, 185, 129, 0.1);
            color: var(--success);
        }
        
        .activity-icon.warning {
            background: rgba(245, 158, 11, 0.1);
            color: var(--warning);
        }
        
        .activity-icon.info {
            background: rgba(37, 99, 235, 0.1);
            color: var(--primary);
        }
        
        .activity-content {
            flex: 1;
        }
        
        .activity-name {
            font-size: 14px;
            font-weight: 500;
            color: var(--text-primary);
            margin-bottom: 3px;
        }
        
        .activity-desc {
            font-size: 13px;
            color: var(--text-secondary);
        }
        
        .activity-time {
            font-size: 12px;
            color: var(--text-muted);
            text-align: right;
        }
        
        /* QR Tools */
        .tools-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }
        
        .tool-card {
            background: var(--bg-secondary);
            border-radius: var(--card-radius);
            padding: 20px;
            box-shadow: var(--shadow);
            transition: var(--transition);
            cursor: pointer;
        }
        
        .tool-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }
        
        .tool-icon {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            margin-bottom: 15px;
            background: rgba(37, 99, 235, 0.1);
            color: var(--primary);
        }
        
        .tool-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 10px;
            color: var(--text-primary);
        }
        
        .tool-desc {
            color: var(--text-secondary);
            font-size: 14px;
            margin-bottom: 15px;
        }
        
        .tool-footer {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .tool-stats {
            font-size: 13px;
            color: var(--text-muted);
        }
        
        .tool-arrow {
            color: var(--primary);
            font-size: 14px;
        }
        
        /* QR Converter */
        .converter-container {
            display: grid;
            grid-template-columns: 1fr;
            gap: 25px;
        }
        
        @media (min-width: 1024px) {
            .converter-container {
                grid-template-columns: 1fr 1fr;
            }
        }
        
        .converter-card {
            background: var(--bg-secondary);
            border-radius: var(--card-radius);
            padding: 25px;
            box-shadow: var(--shadow);
            position: relative;
            overflow: hidden;
        }
        
        .converter-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(to right, var(--primary), var(--accent));
            border-radius: var(--card-radius) var(--card-radius) 0 0;
        }
        
        .card-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 20px;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 10px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .input-group {
            margin-bottom: 20px;
        }
        
        .input-label {
            display: block;
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 8px;
            color: var(--text-secondary);
        }
        
        .input-field {
            width: 100%;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: var(--element-radius);
            padding: 14px 16px;
            color: var(--text-primary);
            font-size: 15px;
            transition: var(--transition);
        }
        
        .input-field:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.2);
        }
        
        .file-upload {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 25px 20px;
            border: 2px dashed var(--border-color);
            border-radius: var(--element-radius);
            cursor: pointer;
            transition: var(--transition);
            background: var(--bg-tertiary);
        }
        
        .file-upload:hover {
            border-color: var(--primary);
            background: rgba(37, 99, 235, 0.05);
        }
        
        .file-upload-icon {
            margin-bottom: 12px;
            color: var(--text-secondary);
            font-size: 32px;
        }
        
        .file-upload-text {
            text-align: center;
            color: var(--text-secondary);
            font-size: 14px;
        }
        
        .button {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            border: none;
            border-radius: var(--button-radius);
            padding: 16px 24px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            width: 100%;
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.25);
        }
        
        .button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(37, 99, 235, 0.35);
        }
        
        .button:active {
            transform: translateY(0);
        }
        
        .button-secondary {
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            color: var(--text-secondary);
            box-shadow: none;
        }
        
        .button-secondary:hover {
            background: var(--bg-secondary);
            border-color: var(--primary);
            color: var(--primary);
            box-shadow: none;
        }
        
        .qr-preview {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 25px;
            background: var(--bg-tertiary);
            border-radius: var(--element-radius);
            min-height: 300px;
            border: 1px solid var(--border-color);
        }
        
        .qr-placeholder {
            color: var(--text-secondary);
            text-align: center;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 12px;
        }
        
        .qr-placeholder-icon {
            font-size: 48px;
            opacity: 0.5;
        }
        
        .alert {
            padding: 14px 16px;
            border-radius: var(--element-radius);
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 10px;
            animation: fadeIn 0.3s ease;
            font-size: 14px;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-8px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .alert-error {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.2);
            color: #ef4444;
        }
        
        .alert-success {
            background: rgba(16, 185, 129, 0.1);
            border: 1px solid rgba(16, 185, 129, 0.2);
            color: var(--success);
        }
        
        .alert-warning {
            background: rgba(245, 158, 11, 0.1);
            border: 1px solid rgba(245, 158, 11, 0.2);
            color: var(--warning);
        }
        
        .alert-info {
            background: rgba(37, 99, 235, 0.1);
            border: 1px solid rgba(37, 99, 235, 0.2);
            color: var(--primary);
        }
        
        .currency-preview {
            position: absolute;
            right: 16px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-secondary);
            font-size: 13px;
            font-weight: 500;
        }
        
        .input-wrapper {
            position: relative;
        }
        
        .action-buttons {
            display: flex;
            gap: 12px;
            margin-top: 20px;
        }
        
        .action-buttons .button {
            width: auto;
            flex: 1;
        }
        
        #qrCanvas {
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            max-width: 100%;
            height: auto;
        }
        
        .amount-preview {
            margin-top: 15px;
            color: var(--text-secondary);
            font-size: 14px;
            text-align: center;
            font-weight: 500;
        }
        
        .success-check {
            color: var(--success);
            margin-right: 8px;
        }
        
        /* Additional Features */
        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 25px;
        }
        
        .feature-card {
            background: var(--bg-secondary);
            border-radius: var(--card-radius);
            padding: 20px;
            box-shadow: var(--shadow);
        }
        
        .feature-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .feature-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            font-size: 18px;
            background: rgba(37, 99, 235, 0.1);
            color: var(--primary);
        }
        
        .feature-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .feature-content {
            color: var(--text-secondary);
            font-size: 14px;
            line-height: 1.6;
        }
        
        .feature-actions {
            margin-top: 15px;
            display: flex;
            gap: 10px;
        }
        
        /* Profile Modal */
        #profileModal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            backdrop-filter: blur(5px);
            display: none;
        }
        
        .profile-container {
            background: var(--bg-secondary);
            border-radius: var(--card-radius);
            padding: 30px;
            width: 90%;
            max-width: 500px;
            box-shadow: var(--shadow-lg);
        }
        
        .profile-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .profile-title {
            font-size: 20px;
            font-weight: 700;
            color: var(--text-primary);
        }
        
        .close-modal {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--bg-tertiary);
            color: var(--text-secondary);
            cursor: pointer;
            transition: var(--transition);
        }
        
        .close-modal:hover {
            background: var(--error);
            color: white;
        }
        
        .profile-avatar {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 25px;
        }
        
        .avatar-image {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            object-fit: cover;
            background: var(--bg-tertiary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 40px;
            color: var(--text-muted);
            position: relative;
            cursor: pointer;
        }
        
        .avatar-change {
            position: absolute;
            bottom: 0;
            right: 0;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: var(--primary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            box-shadow: var(--shadow);
        }
        
        .profile-form {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group.full {
            grid-column: 1 / -1;
        }
        
        .form-label {
            display: block;
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 8px;
            color: var(--text-secondary);
        }
        
        .form-input {
            width: 100%;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: var(--element-radius);
            padding: 12px 14px;
            color: var(--text-primary);
            font-size: 14px;
            transition: var(--transition);
        }
        
        .form-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.2);
        }
        
        .form-input:disabled {
            background: var(--bg-primary);
            color: var(--text-muted);
            cursor: not-allowed;
        }
        
        .form-hint {
            font-size: 12px;
            color: var(--text-muted);
            margin-top: 5px;
        }
        
        .profile-actions {
            display: flex;
            justify-content: flex-end;
            gap: 15px;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid var(--border-color);
        }
        
        /* Responsive */
        @media (max-width: 1024px) {
            .sidebar {
                width: 80px;
            }
            
            .sidebar .logo-text,
            .sidebar .user-info,
            .sidebar .nav-text,
            .sidebar .nav-badge,
            .sidebar .theme-label {
                display: none;
            }
            
            .sidebar-header {
                padding: 20px 15px;
            }
            
            .sidebar-logo {
                justify-content: center;
            }
            
            .user-profile {
                justify-content: center;
            }
            
            .nav-item {
                justify-content: center;
                padding: 15px;
            }
            
            .nav-icon {
                margin-right: 0;
            }
            
            .charts-container {
                grid-template-columns: 1fr;
            }
        }
        
        @media (max-width: 768px) {
            .sidebar {
                position: fixed;
                left: -100%;
                height: 100%;
            }
            
            .sidebar.active {
                left: 0;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .tools-grid {
                grid-template-columns: 1fr;
            }
            
            .search-bar {
                width: 200px;
            }
            
            .mobile-menu-btn {
                display: block;
            }
        }
        
        /* Mobile menu button */
        .mobile-menu-btn {
            display: none;
            width: 40px;
            height: 40px;
            border-radius: 8px;
            background: var(--bg-tertiary);
            color: var(--text-secondary);
            align-items: center;
            justify-content: center;
            cursor: pointer;
            margin-right: 15px;
        }
        
        @media (max-width: 640px) {
            .content-area {
                padding: 15px;
            }
            
            .top-header {
                padding: 15px;
            }
            
            .search-bar {
                display: none;
            }
            
            .mobile-menu-btn {
                display: flex;
            }
            
            .header-actions {
                gap: 10px;
            }
            
            .header-action {
                width: 36px;
                height: 36px;
            }
            
            .profile-form {
                grid-template-columns: 1fr;
            }
        }
        
        /* Animation classes */
        .fade-in {
            animation: fadeIn 0.5s ease;
        }
        
        .slide-in {
            animation: slideIn 0.5s ease;
        }
        
        @keyframes slideIn {
            from { transform: translateX(-20px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        /* Toast notification */
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
        }
        
        .toast {
            padding: 15px 20px;
            background: var(--bg-secondary);
            color: var(--text-primary);
            border-radius: var(--element-radius);
            box-shadow: var(--shadow-lg);
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 10px;
            animation: toastIn 0.3s ease, toastOut 0.3s ease 2.7s forwards;
            max-width: 350px;
        }
        
        .toast-success {
            border-left: 4px solid var(--success);
        }
        
        .toast-error {
            border-left: 4px solid var(--error);
        }
        
        .toast-info {
            border-left: 4px solid var(--primary);
        }
        
        .toast-warning {
            border-left: 4px solid var(--warning);
        }
        
        @keyframes toastIn {
            from { transform: translateX(100px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        @keyframes toastOut {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100px); opacity: 0; }
        }
        
        /* QR Animation */
        @keyframes qrPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .qr-animated {
            animation: qrPulse 2s infinite;
        }
        
        /* Progress bar */
        .progress-bar {
            height: 6px;
            background: var(--bg-tertiary);
            border-radius: 3px;
            overflow: hidden;
            margin-bottom: 15px;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(to right, var(--primary), var(--accent));
            border-radius: 3px;
            transition: width 0.3s ease;
        }
        
        /* Tabs */
        .tabs {
            display: flex;
            gap: 5px;
            background: var(--bg-tertiary);
            border-radius: var(--element-radius);
            padding: 5px;
            margin-bottom: 20px;
        }
        
        .tab {
            padding: 10px 20px;
            border-radius: var(--element-radius);
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            color: var(--text-secondary);
            transition: var(--transition);
            text-align: center;
            flex: 1;
        }
        
        .tab.active {
            background: var(--bg-secondary);
            color: var(--primary);
            box-shadow: var(--shadow);
        }
        
        /* Tooltip */
        .tooltip {
            position: relative;
            display: inline-block;
        }
        
        .tooltip .tooltip-text {
            visibility: hidden;
            width: 200px;
            background: var(--bg-tertiary);
            color: var(--text-primary);
            text-align: center;
            border-radius: var(--element-radius);
            padding: 10px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 13px;
            box-shadow: var(--shadow);
        }
        
        .tooltip:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
        }
        
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: var(--bg-tertiary);
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--text-muted);
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: var(--text-secondary);
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div id="loadingScreen">
        <div class="loader"></div>
        <div class="loading-text">Loading QRIS Professional Tools...</div>
    </div>

    <!-- Auth Modal -->
    <div id="authModal">
        <div class="auth-container">
            <div class="auth-logo">
                <div style="font-size: 48px; color: #2563eb;">
                    <i class="fas fa-qrcode"></i>
                </div>
            </div>
            <h2 class="auth-title">Welcome to QRIS Tools</h2>
            <p class="auth-subtitle">Enter your username to get started</p>
            
            <input type="text" id="usernameInput" class="auth-input" placeholder="Enter your username">
            
            <button id="loginButton" class="auth-button">
                <i class="fas fa-sign-in-alt"></i> Continue
            </button>
        </div>
    </div>

    <!-- Profile Modal -->
    <div id="profileModal">
        <div class="profile-container">
            <div class="profile-header">
                <h3 class="profile-title">Profile Settings</h3>
                <div class="close-modal" id="closeProfileModal">
                    <i class="fas fa-times"></i>
                </div>
            </div>
            
            <div class="profile-avatar">
                <div class="avatar-image" id="profileAvatar">
                    <i class="fas fa-user"></i>
                    <div class="avatar-change">
                        <i class="fas fa-camera"></i>
                    </div>
                </div>
            </div>
            
            <div class="profile-form">
                <div class="form-group full">
                    <label class="form-label">Username</label>
                    <input type="text" class="form-input" id="profileUsername" placeholder="Enter username">
                    <div class="form-hint">Can be changed once every 30 days</div>
                </div>
                
                <div class="form-group full">
                    <label class="form-label">Display Name</label>
                    <input type="text" class="form-input" id="profileDisplayName" placeholder="Enter display name">
                    <div class="form-hint">Auto-generated from username, can be changed once every 30 days</div>
                </div>
                
                <div class="form-group full">
                    <label class="form-label">Email Address</label>
                    <input type="email" class="form-input" id="profileEmail" placeholder="Enter email address">
                    <div class="form-hint" id="emailHint">Requires OTP verification, can be changed once every 30 days</div>
                </div>
                
                <div class="form-group full">
                    <label class="form-label">Phone Number</label>
                    <input type="tel" class="form-input" id="profilePhone" placeholder="Enter phone number">
                    <div class="form-hint" id="phoneHint">Requires OTP verification, can be changed once every 30 days</div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">IP Address</label>
                    <input type="text" class="form-input" id="profileIp" disabled>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Internet Provider</label>
                    <input type="text" class="form-input" id="profileProvider" disabled>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Device Type</label>
                    <input type="text" class="form-input" id="profileDevice" disabled>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Last Login</label>
                    <input type="text" class="form-input" id="profileLastLogin" disabled>
                </div>

                <!-- OTP Verification Section (Initially Hidden) -->
                <div class="form-group full" id="otpSection" style="display: none;">
                    <label class="form-label">OTP Verification</label>
                    <input type="text" class="form-input" id="otpInput" placeholder="Enter OTP code">
                    <div class="form-hint">Check your email/SMS for the OTP code</div>
                    <button class="button" id="verifyOtpButton" style="margin-top: 10px;">
                        <i class="fas fa-check-circle"></i> Verify OTP
                    </button>
                </div>
            </div>
            
            <div class="profile-actions">
                <button class="button button-secondary" id="cancelProfileChanges">
                    Cancel
                </button>
                <button class="button" id="saveProfileChanges">
                    Save Changes
                </button>
            </div>
        </div>
    </div>

    <!-- App Container -->
    <div class="app-container">
        <!-- Sidebar Navigation -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-logo">
                    <div class="logo-icon">
                        <i class="fas fa-qrcode"></i>
                    </div>
                    <div class="logo-text">QRIS Tools</div>
                </div>
                
                <div class="user-profile" id="userProfileButton">
                    <div class="user-avatar">
                        <i class="fas fa-user"></i>
                    </div>
                    <div class="user-info">
                        <div class="user-name" id="sidebarUserName">Guest</div>
                        <div class="user-role">Free Account</div>
                    </div>
                </div>
            </div>
            
            <div class="nav-menu">
                <div class="nav-item active" data-page="dashboard">
                    <div class="nav-icon"><i class="fas fa-home"></i></div>
                    <div class="nav-text">Dashboard</div>
                </div>
                
                <div class="nav-item" data-page="converter">
                    <div class="nav-icon"><i class="fas fa-exchange-alt"></i></div>
                    <div class="nav-text">QR Converter</div>
                </div>
                
                <div class="nav-item" data-page="validator">
                    <div class="nav-icon"><i class="fas fa-check-circle"></i></div>
                    <div class="nav-text">QR Validator</div>
                    <div class="nav-badge">New</div>
                </div>
                
                <div class="nav-item" data-page="generator">
                    <div class="nav-icon"><i class="fas fa-qrcode"></i></div>
                    <div class="nav-text">QR Generator</div>
                </div>
                
                <div class="nav-item" data-page="splitter">
                    <div class="nav-icon"><i class="fas fa-money-bill-wave"></i></div>
                    <div class="nav-text">Split Bill</div>
                </div>
                
                <div class="nav-item" data-page="tracking">
                    <div class="nav-icon"><i class="fas fa-chart-line"></i></div>
                    <div class="nav-text">QR Tracking</div>
                </div>
                
                <div class="nav-item" data-page="security">
                    <div class="nav-icon"><i class="fas fa-shield-alt"></i></div>
                    <div class="nav-text">Security Mode</div>
                </div>
                
                <div class="nav-item" data-page="backup">
                    <div class="nav-icon"><i class="fas fa-database"></i></div>
                    <div class="nav-text">Backup & Restore</div>
                </div>
                
                <div class="nav-item" data-page="settings">
                    <div class="nav-icon"><i class="fas fa-cog"></i></div>
                    <div class="nav-text">Settings</div>
                </div>
            </div>
            
            <div class="sidebar-footer">
                <div class="theme-switcher">
                    <span class="theme-label">Dark Mode</span>
                    <label class="switch">
                        <input type="checkbox" id="themeSwitch">
                        <span class="slider"></span>
                    </label>
                </div>
                
                <div class="nav-item" id="logoutButton">
                    <div class="nav-icon"><i class="fas fa-sign-out-alt"></i></div>
                    <div class="nav-text">Logout</div>
                </div>
            </div>
        </div>
        
        <!-- Main Content -->
        <div class="main-content">
            <!-- Top Header -->
            <div class="top-header">
                <div style="display: flex; align-items: center;">
                    <div class="mobile-menu-btn" id="mobileMenuButton">
                        <i class="fas fa-bars"></i>
                    </div>
                    
                    <div class="search-bar">
                        <div class="search-icon"><i class="fas fa-search"></i></div>
                        <input type="text" class="search-input" placeholder="Search...">
                    </div>
                </div>
                
                <div class="header-actions">
                    <div class="header-action" id="pingTestButton">
                        <i class="fas fa-wifi"></i>
                    </div>
                    
                    <div class="header-action">
                        <i class="fas fa-bell"></i>
                        <div class="notification-badge">3</div>
                    </div>
                    
                    <div class="header-action" id="themeButton">
                        <i class="fas fa-palette"></i>
                    </div>
                </div>
            </div>
            
            <!-- Content Area -->
            <div class="content-area">
                <!-- Dashboard Page -->
                <div class="page-content" id="dashboardPage">
                    <h1 class="page-title">Dashboard</h1>
                    <p class="page-subtitle">Welcome back, <span id="dashboardUserName">Guest</span>! Here's your QRIS activity summary.</p>
                    
                    <!-- Stats Grid -->
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-icon blue">
                                <i class="fas fa-qrcode"></i>
                            </div>
                            <div class="stat-value" id="statQrGenerated">0</div>
                            <div class="stat-label">QR Codes Generated</div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-icon green">
                                <i class="fas fa-check-circle"></i>
                            </div>
                            <div class="stat-value" id="statQrValidated">0</div>
                            <div class="stat-label">QR Codes Validated</div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-icon purple">
                                <i class="fas fa-share-alt"></i>
                            </div>
                            <div class="stat-value" id="statQrShared">0</div>
                            <div class="stat-label">QR Codes Shared</div>
                        </div>
                        
                        <div class="stat-card">
                            <div class="stat-icon orange">
                                <i class="fas fa-chart-line"></i>
                            </div>
                            <div class="stat-value" id="statTracking">0</div>
                            <div class="stat-label">QR Tracking Events</div>
                        </div>
                    </div>
                    
                    <!-- Charts Container -->
                    <div class="charts-container">
                        <div class="chart-card">
                            <div class="chart-header">
                                <div class="chart-title">QR Code Generation History</div>
                                <div class="chart-actions">
                                    <div class="chart-action"><i class="fas fa-download"></i></div>
                                    <div class="chart-action"><i class="fas fa-expand"></i></div>
                                </div>
                            </div>
                            <div id="qrChart" style="height: 250px;">
                                <!-- Chart will be rendered by JavaScript -->
                            </div>
                        </div>
                        
                        <div class="chart-card">
                            <div class="chart-header">
                                <div class="chart-title">QR Code Types</div>
                                <div class="chart-actions">
                                    <div class="chart-action"><i class="fas fa-download"></i></div>
                                    <div class="chart-action"><i class="fas fa-expand"></i></div>
                                </div>
                            </div>
                            <div id="typeChart" style="height: 250px;">
                                <!-- Pie chart will be rendered by JavaScript -->
                            </div>
                        </div>
                    </div>
                    
                    <!-- Recent Activity -->
                    <div class="recent-activity">
                        <div class="activity-header">
                            <div class="activity-title">Recent Activity</div>
                            <div class="view-all">View All</div>
                        </div>
                        
                        <ul class="activity-list" id="recentActivityList">
                            <!-- Activity items will be populated by JavaScript -->
                        </ul>
                    </div>
                </div>
                
                <!-- QR Converter Page -->
                <div class="page-content" id="converterPage" style="display: none;">
                    <h1 class="page-title">QRIS Converter</h1>
                    <p class="page-subtitle">Convert QRIS static to dynamic or add nominal values to existing QRIS</p>
                    
                    <div class="converter-container">
                        <div class="converter-card">
                            <h2 class="card-title">
                                <i class="fas fa-upload" style="color: #3b82f6;"></i>
                                Input QRIS
                            </h2>
                            
                            <div class="input-group">
                                <label class="input-label">Upload QRIS Image</label>
                                <div class="file-upload" id="qrUploadArea">
                                    <div class="file-upload-icon">
                                        <i class="fas fa-cloud-upload-alt"></i>
                                    </div>
                                    <div class="file-upload-text">
                                        Click to upload or drag and drop<br>
                                        <span style="font-size: 12px; color: var(--text-muted);">SVG, PNG, JPG or GIF (max. 5MB)</span>
                                    </div>
                                    <input type="file" id="qrUploadInput" accept="image/*" style="display: none;">
                                </div>
                            </div>
                            
                            <div class="input-group">
                                <label class="input-label">Or Enter QRIS String</label>
                                <textarea class="input-field" id="qrStringInput" rows="4" placeholder="Paste QRIS string here..."></textarea>
                            </div>
                            
                            <div class="alert alert-info">
                                <i class="fas fa-info-circle"></i> QRIS string will be automatically extracted from uploaded image
                            </div>
                            
                            <button class="button" id="extractQrButton">
                                <i class="fas fa-bolt"></i> Extract QR Data
                            </button>
                        </div>
                        
                        <div class="converter-card">
                            <h2 class="card-title">
                                <i class="fas fa-sliders-h" style="color: #8b5cf6;"></i>
                                Customize QRIS
                            </h2>
                            
                            <div class="input-group">
                                <label class="input-label">Merchant Name</label>
                                <input type="text" class="input-field" id="merchantNameInput" placeholder="Enter merchant name">
                            </div>
                            
                            <div class="input-group">
                                <label class="input-label">Transaction Amount (IDR)</label>
                                <div class="input-wrapper">
                                    <input type="number" class="input-field" id="amountInput" placeholder="Enter amount">
                                    <div class="currency-preview">IDR</div>
                                </div>
                            </div>
                            
                            <div class="input-group">
                                <label class="input-label">Additional Notes (Optional)</label>
                                <input type="text" class="input-field" id="notesInput" placeholder="Enter notes">
                            </div>
                            
                            <div class="input-group">
                                <label class="input-label">QR Expiry</label>
                                <select class="input-field" id="expirySelect">
                                    <option value="no-expiry">No Expiry</option>
                                    <option value="1-hour">1 Hour</option>
                                    <option value="6-hours">6 Hours</option>
                                    <option value="24-hours">24 Hours</option>
                                    <option value="3-days">3 Days</option>
                                    <option value="7-days">7 Days</option>
                                    <option value="30-days">30 Days</option>
                                    <option value="custom">Custom Date/Time</option>
                                </select>
                            </div>
                            
                            <div class="input-group" id="customExpiryGroup" style="display: none;">
                                <label class="input-label">Custom Expiry Date & Time</label>
                                <input type="datetime-local" class="input-field" id="customExpiryInput">
                            </div>
                            
                            <div class="alert alert-success" id="conversionResult" style="display: none;">
                                <i class="fas fa-check-circle success-check"></i>
                                <span id="conversionMessage">QRIS successfully converted!</span>
                            </div>
                            
                            <button class="button" id="generateQrButton">
                                <i class="fas fa-qrcode"></i> Generate Dynamic QRIS
                            </button>
                        </div>
                    </div>
                    
                    <div class="converter-card" style="margin-top: 25px;">
                        <h2 class="card-title">
                            <i class="fas fa-eye" style="color: #06b6d4;"></i>
                            QR Preview
                        </h2>
                        
                        <div class="qr-preview" id="qrPreview">
                            <div class="qr-placeholder">
                                <div class="qr-placeholder-icon">
                                    <i class="fas fa-qrcode"></i>
                                </div>
                                <div>QR code will appear here after generation</div>
                            </div>
                        </div>
                        
                        <div class="amount-preview" id="amountPreview" style="display: none;">
                            Amount: <strong id="previewAmount">0</strong> IDR
                        </div>
                        
                        <div class="action-buttons" id="qrActionButtons" style="display: none;">
                            <button class="button button-secondary" id="downloadQrButton">
                                <i class="fas fa-download"></i> Download
                            </button>
                            <button class="button" id="shareQrButton">
                                <i class="fas fa-share-alt"></i> Share
                            </button>
                            <button class="button" id="trackQrButton">
                                <i class="fas fa-chart-line"></i> Enable Tracking
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- QR Validator Page -->
                <div class="page-content" id="validatorPage" style="display: none;">
                    <h1 class="page-title">QRIS Validator</h1>
                    <p class="page-subtitle">Validate QRIS codes and check their authenticity</p>
                    
                    <div class="converter-container">
                        <div class="converter-card">
                            <h2 class="card-title">
                                <i class="fas fa-upload" style="color: #3b82f6;"></i>
                                Input QRIS to Validate
                            </h2>
                            
                            <div class="input-group">
                                <label class="input-label">Upload QRIS Image</label>
                                <div class="file-upload" id="validatorUploadArea">
                                    <div class="file-upload-icon">
                                        <i class="fas fa-cloud-upload-alt"></i>
                                    </div>
                                    <div class="file-upload-text">
                                        Click to upload or drag and drop<br>
                                        <span style="font-size: 12px; color: var(--text-muted);">SVG, PNG, JPG or GIF (max. 5MB)</span>
                                    </div>
                                    <input type="file" id="validatorUploadInput" accept="image/*" style="display: none;">
                                </div>
                            </div>
                            
                            <div class="input-group">
                                <label class="input-label">Or Enter QRIS String</label>
                                <textarea class="input-field" id="validatorStringInput" rows="4" placeholder="Paste QRIS string here..."></textarea>
                            </div>
                            
                            <button class="button" id="validateQrButton">
                                <i class="fas fa-check-circle"></i> Validate QRIS
                            </button>
                        </div>
                        
                        <div class="converter-card">
                            <h2 class="card-title">
                                <i class="fas fa-info-circle" style="color: #8b5cf6;"></i>
                                Validation Results
                            </h2>
                            
                            <div id="validationResults">
                                <div class="alert alert-info">
                                    <i class="fas fa-info-circle"></i> QRIS validation results will appear here
                                </div>
                            </div>
                            
                            <div class="input-group">
                                <label class="input-label">Merchant Information</label>
                                <div class="input-field" id="merchantInfo" style="height: auto; padding: 12px; background: var(--bg-secondary);">
                                    No merchant information available
                                </div>
                            </div>
                            
                            <div class="input-group">
                                <label class="input-label">Transaction Details</label>
                                <div class="input-field" id="transactionInfo" style="height: auto; padding: 12px; background: var(--bg-secondary);">
                                    No transaction details available
                                </div>
                            </div>
                            
                            <div class="alert alert-warning" id="securityWarning" style="display: none;">
                                <i class="fas fa-exclamation-triangle"></i>
                                <span id="warningMessage">Potential security issue detected</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- QR Generator Page -->
                <div class="page-content" id="generatorPage" style="display: none;">
                    <h1 class="page-title">QRIS Generator</h1>
                    <p class="page-subtitle">Create new QRIS codes from scratch</p>
                    
                    <div class="converter-container">
                        <div class="converter-card">
                            <h2 class="card-title">
                                <i class="fas fa-info-circle" style="color: #3b82f6;"></i>
                                Merchant Information
                            </h2>
                            
                            <div class="input-group">
                                <label class="input-label">Merchant Name *</label>
                                <input type="text" class="input-field" id="genMerchantName" placeholder="Enter merchant name" required>
                            </div>
                            
                            <div class="input-group">
                                <label class="input-label">Merchant City *</label>
                                <input type="text" class="input-field" id="genMerchantCity" placeholder="Enter merchant city" required>
                            </div>
                            
                            <div class="input-group">
                                <label class="input-label">Merchant ID</label>
                                <input type="text" class="input-field" id="genMerchantId" placeholder="Enter merchant ID (optional)">
                            </div>
                            
                            <div class="input-group">
                                <label class="input-label">Postal Code</label>
                                <input type="text" class="input-field" id="genPostalCode" placeholder="Enter postal code (optional)">
                            </div>
                        </div>
                        
                        <div class="converter-card">
                            <h2 class="card-title">
                                <i class="fas fa-money-bill-wave" style="color: #8b5cf6;"></i>
                                Transaction Details
                            </h2>
                            
                            <div class="input-group">
                                <label class="input-label">Transaction Amount (IDR)</label>
                                <div class="input-wrapper">
                                    <input type="number" class="input-field" id="genAmount" placeholder="Enter amount (0 for static QR)">
                                    <div class="currency-preview">IDR</div>
                                </div>
                            </div>
                            
                            <div class="input-group">
                                <label class="input-label">Transaction Type</label>
                                <select class="input-field" id="genTxType">
                                    <option value="static">Static QR (No Amount)</option>
                                    <option value="dynamic">Dynamic QR (With Amount)</option>
                                </select>
                            </div>
                            
                            <div class="input-group">
                                <label class="input-label">Additional Notes (Optional)</label>
                                <input type="text" class="input-field" id="genNotes" placeholder="Enter notes">
                            </div>
                            
                            <div class="alert alert-info">
                                <i class="fas fa-info-circle"></i> Static QR codes can be used for multiple transactions, Dynamic QR codes are for specific amounts.
                            </div>
                            
                            <button class="button" id="generateNewQrButton">
                                <i class="fas fa-qrcode"></i> Generate QRIS
                            </button>
                        </div>
                    </div>
                    
                    <div class="converter-card" style="margin-top: 25px;">
                        <h2 class="card-title">
                            <i class="fas fa-eye" style="color: #06b6d4;"></i>
                            QR Preview
                        </h2>
                        
                        <div class="qr-preview" id="genQrPreview">
                            <div class="qr-placeholder">
                                <div class="qr-placeholder-icon">
                                    <i class="fas fa-qrcode"></i>
                                </div>
                                <div>QR code will appear here after generation</div>
                            </div>
                        </div>
                        
                        <div class="amount-preview" id="genAmountPreview" style="display: none;">
                            Amount: <strong id="genPreviewAmount">0</strong> IDR
                        </div>
                        
                        <div class="action-buttons" id="genQrActionButtons" style="display: none;">
                            <button class="button button-secondary" id="genDownloadQrButton">
                                <i class="fas fa-download"></i> Download
                            </button>
                            <button class="button" id="genShareQrButton">
                                <i class="fas fa-share-alt"></i> Share
                            </button>
                            <button class="button" id="genSaveQrButton">
                                <i class="fas fa-save"></i> Save to History
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Split Bill Page -->
                <div class="page-content" id="splitterPage" style="display: none;">
                    <h1 class="page-title">Split Bill</h1>
                    <p class="page-subtitle">Split payments and generate multiple QRIS codes</p>
                    
                    <div class="converter-container">
                        <div class="converter-card">
                            <h2 class="card-title">
                                <i class="fas fa-receipt" style="color: #3b82f6;"></i>
                                Bill Information
                            </h2>
                            
                            <div class="input-group">
                                <label class="input-label">Total Amount (IDR) *</label>
                                <div class="input-wrapper">
                                    <input type="number" class="input-field" id="splitTotalAmount" placeholder="Enter total amount">
                                    <div class="currency-preview">IDR</div>
                                </div>
                            </div>
                            
                            <div class="input-group">
                                <label class="input-label">Bill Description</label>
                                <input type="text" class="input-field" id="splitDescription" placeholder="Enter bill description">
                            </div>
                            
                            <div class="input-group">
                                <label class="input-label">Number of People *</label>
                                <input type="number" class="input-field" id="splitPeopleCount" placeholder="Enter number of people" min="2" max="20">
                            </div>
                            
                            <div class="input-group">
                                <label class="input-label">Split Type</label>
                                <select class="input-field" id="splitType">
                                    <option value="equal">Equal Split</option>
                                    <option value="custom">Custom Amounts</option>
                                </select>
                            </div>
                            
                            <div id="customAmountsContainer" style="display: none;">
                                <div class="input-group">
                                    <label class="input-label">Custom Amounts</label>
                                    <div id="customAmountsList">
                                        <!-- Custom amounts will be added here by JavaScript -->
                                    </div>
                                </div>
                            </div>
                            
                            <button class="button" id="calculateSplitButton">
                                <i class="fas fa-calculator"></i> Calculate Split
                            </button>
                        </div>
                        
                        <div class="converter-card">
                            <h2 class="card-title">
                                <i class="fas fa-users" style="color: #8b5cf6;"></i>
                                Split Results
                            </h2>
                            
                            <div id="splitResults">
                                <div class="alert alert-info">
                                    <i class="fas fa-info-circle"></i> Split results will appear here after calculation
                                </div>
                            </div>
                            
                            <div class="input-group">
                                <label class="input-label">Merchant Name for QRIS</label>
                                <input type="text" class="input-field" id="splitMerchantName" placeholder="Enter merchant name">
                            </div>
                            
                            <button class="button" id="generateSplitQrButton" disabled>
                                <i class="fas fa-qrcode"></i> Generate Split QRIS
                            </button>
                        </div>
                    </div>
                    
                    <div class="converter-card" style="margin-top: 25px; display: none;" id="splitQrSection">
                        <h2 class="card-title">
                            <i class="fas fa-qrcode" style="color: #06b6d4;"></i>
                            Split QRIS Codes
                        </h2>
                        
                        <div id="splitQrContainer" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 20px;">
                            <!-- Split QR codes will be added here by JavaScript -->
                        </div>
                        
                        <div class="action-buttons" style="margin-top: 20px;">
                            <button class="button button-secondary" id="downloadAllSplitQrButton">
                                <i class="fas fa-download"></i> Download All
                            </button>
                            <button class="button" id="shareAllSplitQrButton">
                                <i class="fas fa-share-alt"></i> Share All
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Other pages will be implemented similarly -->
                <div class="page-content" id="trackingPage" style="display: none;">
                    <h1 class="page-title">QR Tracking</h1>
                    <p class="page-subtitle">Track your QRIS code usage and statistics</p>
                    
                    <!-- Content for tracking page -->
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle"></i> QR Tracking feature is coming soon. This will allow you to track scans and usage of your QR codes.
                    </div>
                </div>
                
                <div class="page-content" id="securityPage" style="display: none;">
                    <h1 class="page-title">Security Mode</h1>
                    <p class="page-subtitle">Enhanced security features for your QRIS transactions</p>
                    
                    <!-- Content for security page -->
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle"></i> Security Mode is coming soon. This will include additional verification steps for sensitive transactions.
                    </div>
                </div>
                
                <div class="page-content" id="backupPage" style="display: none;">
                    <h1 class="page-title">Backup & Restore</h1>
                    <p class="page-subtitle">Backup your QRIS data and restore when needed</p>
                    
                    <div class="converter-container">
                        <div class="converter-card">
                            <h2 class="card-title">
                                <i class="fas fa-database" style="color: #3b82f6;"></i>
                                Backup Data
                            </h2>
                            
                            <div class="input-group">
                                <label class="input-label">Encryption Password</label>
                                <input type="password" class="input-field" id="backupPassword" placeholder="Enter encryption password">
                            </div>
                            
                            <div class="input-group">
                                <label class="input-label">Confirm Password</label>
                                <input type="password" class="input-field" id="backupPasswordConfirm" placeholder="Confirm encryption password">
                            </div>
                            
                            <div class="alert alert-info">
                                <i class="fas fa-info-circle"></i> Your data will be encrypted with AES-256 before backup.
                            </div>
                            
                            <button class="button" id="backupDataButton">
                                <i class="fas fa-download"></i> Backup Data
                            </button>
                        </div>
                        
                        <div class="converter-card">
                            <h2 class="card-title">
                                <i class="fas fa-upload" style="color: #8b5cf6;"></i>
                                Restore Data
                            </h2>
                            
                            <div class="input-group">
                                <label class="input-label">Upload Backup File</label>
                                <div class="file-upload" id="restoreUploadArea">
                                    <div class="file-upload-icon">
                                        <i class="fas fa-file-upload"></i>
                                    </div>
                                    <div class="file-upload-text">
                                        Click to upload backup file<br>
                                        <span style="font-size: 12px; color: var(--text-muted);">.qrisbackup format only</span>
                                    </div>
                                    <input type="file" id="restoreUploadInput" accept=".qrisbackup" style="display: none;">
                                </div>
                            </div>
                            
                            <div class="input-group">
                                <label class="input-label">Encryption Password</label>
                                <input type="password" class="input-field" id="restorePassword" placeholder="Enter encryption password">
                            </div>
                            
                            <button class="button" id="restoreDataButton" disabled>
                                <i class="fas fa-upload"></i> Restore Data
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="page-content" id="settingsPage" style="display: none;">
                    <h1 class="page-title">Settings</h1>
                    <p class="page-subtitle">Customize your QRIS Tools experience</p>
                    
                    <div class="settings-container">
                        <div class="settings-group">
                            <h3 class="settings-title">Appearance</h3>
                            
                            <div class="setting-item">
                                <div class="setting-info">
                                    <div class="setting-name">Dark Mode</div>
                                    <div class="setting-description">Switch between light and dark themes</div>
                                </div>
                                <label class="switch">
                                    <input type="checkbox" id="settingsThemeSwitch">
                                    <span class="slider"></span>
                                </label>
                            </div>
                            
                            <div class="setting-item">
                                <div class="setting-info">
                                    <div class="setting-name">Language</div>
                                    <div class="setting-description">Interface language</div>
                                </div>
                                <select class="setting-select" id="languageSelect">
                                    <option value="id">Bahasa Indonesia</option>
                                    <option value="en">English</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="settings-group">
                            <h3 class="settings-title">QR Preferences</h3>
                            
                            <div class="setting-item">
                                <div class="setting-info">
                                    <div class="setting-name">Default QR Size</div>
                                    <div class="setting-description">Default size for generated QR codes</div>
                                </div>
                                <select class="setting-select" id="qrSizeSelect">
                                    <option value="200">200x200 px</option>
                                    <option value="300" selected>300x300 px</option>
                                    <option value="400">400x400 px</option>
                                    <option value="500">500x500 px</option>
                                </select>
                            </div>
                            
                            <div class="setting-item">
                                <div class="setting-info">
                                    <div class="setting-name">Default Format</div>
                                    <div class="setting-description">Default file format for QR codes</div>
                                </div>
                                <select class="setting-select" id="qrFormatSelect">
                                    <option value="png">PNG</option>
                                    <option value="jpeg">JPEG</option>
                                    <option value="svg">SVG</option>
                                </select>
                            </div>
                            
                            <div class="setting-item">
                                <div class="setting-info">
                                    <div class="setting-name">Auto-save Generated QR</div>
                                    <div class="setting-description">Automatically save generated QR codes to history</div>
                                </div>
                                <label class="switch">
                                    <input type="checkbox" id="autoSaveSwitch" checked>
                                    <span class="slider"></span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="settings-group">
                            <h3 class="settings-title">Security</h3>
                            
                            <div class="setting-item">
                                <div class="setting-info">
                                    <div class="setting-name">Auto-logout Timer</div>
                                    <div class="setting-description">Automatically logout after inactivity</div>
                                </div>
                                <select class="setting-select" id="autoLogoutSelect">
                                    <option value="0">Disabled</option>
                                    <option value="5">5 minutes</option>
                                    <option value="15">15 minutes</option>
                                    <option value="30">30 minutes</option>
                                    <option value="60">1 hour</option>
                                </select>
                            </div>
                            
                            <div class="setting-item">
                                <div class="setting-info">
                                    <div class="setting-name">Password Protection</div>
                                    <div class="setting-description">Require password for sensitive actions</div>
                                </div>
                                <label class="switch">
                                    <input type="checkbox" id="passwordProtectionSwitch" checked>
                                    <span class="slider"></span>
                                </label>
                            </div>
                        </div>
                        
                        <div class="settings-group">
                            <h3 class="settings-title">Data Management</h3>
                            
                            <div class="setting-item">
                                <div class="setting-info">
                                    <div class="setting-name">Clear History</div>
                                    <div class="setting-description">Delete all generated QR code history</div>
                                </div>
                                <button class="button button-danger" id="clearHistoryButton">
                                    <i class="fas fa-trash"></i> Clear History
                                </button>
                            </div>
                            
                            <div class="setting-item">
                                <div class="setting-info">
                                    <div class="setting-name">Reset All Settings</div>
                                    <div class="setting-description">Restore all settings to default values</div>
                                </div>
                                <button class="button button-danger" id="resetSettingsButton">
                                    <i class="fas fa-undo"></i> Reset Settings
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Notifications -->
    <div id="toastContainer"></div>

    <!-- JavaScript Implementation -->
    <script>
        // ==================== CONFIGURATION & INITIALIZATION ====================
        // Firebase configuration (replace with your actual config)
        const firebaseConfig = {
            apiKey: "AIzaSyDummyAPIKeyForQRISProject",
            authDomain: "qris-tools.firebaseapp.com",
            databaseURL: "https://qris-tools-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "qris-tools",
            storageBucket: "qris-tools.appspot.com",
            messagingSenderId: "123456789",
            appId: "1:123456789:web:abcd1234efgh5678"
        };
        
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const database = firebase.database();
        const storage = firebase.storage();
        
        // Global variables
        let currentUser = null;
        let userData = null;
        let qrHistory = [];
        let currentQrData = null;
        let splitBillData = null;
        
        // DOM Elements
        const elements = {
            loadingScreen: document.getElementById('loadingScreen'),
            authModal: document.getElementById('authModal'),
            profileModal: document.getElementById('profileModal'),
            appContainer: document.querySelector('.app-container'),
            sidebar: document.getElementById('sidebar'),
            mobileMenuButton: document.getElementById('mobileMenuButton'),
            userProfileButton: document.getElementById('userProfileButton'),
            logoutButton: document.getElementById('logoutButton'),
            themeSwitch: document.getElementById('themeSwitch'),
            themeButton: document.getElementById('themeButton'),
            pingTestButton: document.getElementById('pingTestButton'),
            closeProfileModal: document.getElementById('closeProfileModal'),
            cancelProfileChanges: document.getElementById('cancelProfileChanges'),
            saveProfileChanges: document.getElementById('saveProfileChanges'),
            profileUsername: document.getElementById('profileUsername'),
            profileDisplayName: document.getElementById('profileDisplayName'),
            profileEmail: document.getElementById('profileEmail'),
            profilePhone: document.getElementById('profilePhone'),
            profileIp: document.getElementById('profileIp'),
            profileProvider: document.getElementById('profileProvider'),
            profileDevice: document.getElementById('profileDevice'),
            profileLastLogin: document.getElementById('profileLastLogin'),
            otpSection: document.getElementById('otpSection'),
            otpInput: document.getElementById('otpInput'),
            verifyOtpButton: document.getElementById('verifyOtpButton'),
            loginButton: document.getElementById('loginButton'),
            usernameInput: document.getElementById('usernameInput'),
            sidebarUserName: document.getElementById('sidebarUserName'),
            dashboardUserName: document.getElementById('dashboardUserName'),
            statQrGenerated: document.getElementById('statQrGenerated'),
            statQrValidated: document.getElementById('statQrValidated'),
            statQrShared: document.getElementById('statQrShared'),
            statTracking: document.getElementById('statTracking'),
            recentActivityList: document.getElementById('recentActivityList'),
            qrUploadArea: document.getElementById('qrUploadArea'),
            qrUploadInput: document.getElementById('qrUploadInput'),
            qrStringInput: document.getElementById('qrStringInput'),
            extractQrButton: document.getElementById('extractQrButton'),
            merchantNameInput: document.getElementById('merchantNameInput'),
            amountInput: document.getElementById('amountInput'),
            notesInput: document.getElementById('notesInput'),
            expirySelect: document.getElementById('expirySelect'),
            customExpiryGroup: document.getElementById('customExpiryGroup'),
            customExpiryInput: document.getElementById('customExpiryInput'),
            generateQrButton: document.getElementById('generateQrButton'),
            conversionResult: document.getElementById('conversionResult'),
            conversionMessage: document.getElementById('conversionMessage'),
            qrPreview: document.getElementById('qrPreview'),
            amountPreview: document.getElementById('amountPreview'),
            previewAmount: document.getElementById('previewAmount'),
            qrActionButtons: document.getElementById('qrActionButtons'),
            downloadQrButton: document.getElementById('downloadQrButton'),
            shareQrButton: document.getElementById('shareQrButton'),
            trackQrButton: document.getElementById('trackQrButton'),
            validatorUploadArea: document.getElementById('validatorUploadArea'),
            validatorUploadInput: document.getElementById('validatorUploadInput'),
            validatorStringInput: document.getElementById('validatorStringInput'),
            validateQrButton: document.getElementById('validateQrButton'),
            validationResults: document.getElementById('validationResults'),
            merchantInfo: document.getElementById('merchantInfo'),
            transactionInfo: document.getElementById('transactionInfo'),
            securityWarning: document.getElementById('securityWarning'),
            warningMessage: document.getElementById('warningMessage'),
            genMerchantName: document.getElementById('genMerchantName'),
            genMerchantCity: document.getElementById('genMerchantCity'),
            genMerchantId: document.getElementById('genMerchantId'),
            genPostalCode: document.getElementById('genPostalCode'),
            genAmount: document.getElementById('genAmount'),
            genTxType: document.getElementById('genTxType'),
            genNotes: document.getElementById('genNotes'),
            generateNewQrButton: document.getElementById('generateNewQrButton'),
            genQrPreview: document.getElementById('genQrPreview'),
            genAmountPreview: document.getElementById('genAmountPreview'),
            genPreviewAmount: document.getElementById('genPreviewAmount'),
            genQrActionButtons: document.getElementById('genQrActionButtons'),
            genDownloadQrButton: document.getElementById('genDownloadQrButton'),
            genShareQrButton: document.getElementById('genShareQrButton'),
            genSaveQrButton: document.getElementById('genSaveQrButton'),
            splitTotalAmount: document.getElementById('splitTotalAmount'),
            splitDescription: document.getElementById('splitDescription'),
            splitPeopleCount: document.getElementById('splitPeopleCount'),
            splitType: document.getElementById('splitType'),
            customAmountsContainer: document.getElementById('customAmountsContainer'),
            customAmountsList: document.getElementById('customAmountsList'),
            calculateSplitButton: document.getElementById('calculateSplitButton'),
            splitResults: document.getElementById('splitResults'),
            splitMerchantName: document.getElementById('splitMerchantName'),
            generateSplitQrButton: document.getElementById('generateSplitQrButton'),
            splitQrSection: document.getElementById('splitQrSection'),
            splitQrContainer: document.getElementById('splitQrContainer'),
            downloadAllSplitQrButton: document.getElementById('downloadAllSplitQrButton'),
            shareAllSplitQrButton: document.getElementById('shareAllSplitQrButton'),
            backupPassword: document.getElementById('backupPassword'),
            backupPasswordConfirm: document.getElementById('backupPasswordConfirm'),
            backupDataButton: document.getElementById('backupDataButton'),
            restoreUploadArea: document.getElementById('restoreUploadArea'),
            restoreUploadInput: document.getElementById('restoreUploadInput'),
            restorePassword: document.getElementById('restorePassword'),
            restoreDataButton: document.getElementById('restoreDataButton'),
            settingsThemeSwitch: document.getElementById('settingsThemeSwitch'),
            languageSelect: document.getElementById('languageSelect'),
            qrSizeSelect: document.getElementById('qrSizeSelect'),
            qrFormatSelect: document.getElementById('qrFormatSelect'),
            autoSaveSwitch: document.getElementById('autoSaveSwitch'),
            autoLogoutSelect: document.getElementById('autoLogoutSelect'),
            passwordProtectionSwitch: document.getElementById('passwordProtectionSwitch'),
            clearHistoryButton: document.getElementById('clearHistoryButton'),
            resetSettingsButton: document.getElementById('resetSettingsButton')
        };
        
        // Navigation items
        const navItems = document.querySelectorAll('.nav-item');
        const pageContents = document.querySelectorAll('.page-content');
        
        // ==================== UTILITY FUNCTIONS ====================
        
        // Show toast notification
        function showToast(message, type = 'info', duration = 3000) {
            const toast = document.createElement('div');
            toast.className = `toast toast-${type}`;
            toast.innerHTML = `
                <div class="toast-content">
                    <div class="toast-icon">
                        ${type === 'success' ? '<i class="fas fa-check-circle"></i>' : ''}
                        ${type === 'error' ? '<i class="fas fa-exclamation-circle"></i>' : ''}
                        ${type === 'warning' ? '<i class="fas fa-exclamation-triangle"></i>' : ''}
                        ${type === 'info' ? '<i class="fas fa-info-circle"></i>' : ''}
                    </div>
                    <div class="toast-message">${message}</div>
                </div>
                <div class="toast-progress"></div>
            `;
            
            elements.toastContainer.appendChild(toast);
            
            // Animate in
            setTimeout(() => {
                toast.classList.add('show');
            }, 10);
            
            // Animate out and remove
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => {
                    elements.toastContainer.removeChild(toast);
                }, 300);
            }, duration);
        }
        
        // Format currency (IDR)
        function formatCurrency(amount) {
            return new Intl.NumberFormat('id-ID', {
                style: 'currency',
                currency: 'IDR',
                minimumFractionDigits: 0
            }).format(amount);
        }
        
        // Format date
        function formatDate(date) {
            return new Intl.DateTimeFormat('id-ID', {
                day: '2-digit',
                month: 'long',
                year: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            }).format(date);
        }
        
        // Generate random ID
        function generateId(length = 12) {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
            let result = '';
            for (let i = 0; i < length; i++) {
                result += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return result;
        }
        
        // Validate email format
        function isValidEmail(email) {
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return emailRegex.test(email);
        }
        
        // Validate phone number format (Indonesian)
        function isValidPhone(phone) {
            const phoneRegex = /^(\+62|62|0)8[1-9][0-9]{6,9}$/;
            return phoneRegex.test(phone);
        }
        
        // Simulate ping test
        async function pingTest() {
            showToast('Testing ping...', 'info', 2000);
            
            // Simulate ping to multiple servers
            const servers = [
                'https://www.google.com',
                'https://www.facebook.com',
                'https://www.amazon.com',
                'https://www.netflix.com'
            ];
            
            const results = [];
            
            for (const server of servers) {
                const startTime = new Date().getTime();
                
                try {
                    // Using a simple fetch request to measure response time
                    await fetch(server, { method: 'HEAD', cache: 'no-store' });
                    const endTime = new Date().getTime();
                    const pingTime = endTime - startTime;
                    
                    results.push({
                        server: new URL(server).hostname,
                        ping: pingTime,
                        status: 'success'
                    });
                } catch (error) {
                    results.push({
                        server: new URL(server).hostname,
                        ping: 0,
                        status: 'failed'
                    });
                }
            }
            
            // Show ping results
            const averagePing = results.filter(r => r.status === 'success')
                                      .reduce((sum, r) => sum + r.ping, 0) / 
                              results.filter(r => r.status === 'success').length;
            
            showToast(`Ping test completed. Average: ${Math.round(averagePing)}ms`, 'success', 3000);
            
            return results;
        }
        
        // Get user's IP information
        async function getIpInfo() {
            try {
                const response = await fetch('https://ipapi.co/json/');
                const data = await response.json();
                return data;
            } catch (error) {
                console.error('Error getting IP info:', error);
                return {
                    ip: 'Unknown',
                    city: 'Unknown',
                    region: 'Unknown',
                    country_name: 'Unknown',
                    org: 'Unknown Internet Provider'
                };
            }
        }
        
        // ==================== AUTHENTICATION & USER MANAGEMENT ====================
        
        // Initialize authentication state
        function initAuth() {
            // Check if user is already logged in (from localStorage)
            const savedUser = localStorage.getItem('qrisUser');
            if (savedUser) {
                try {
                    currentUser = JSON.parse(savedUser);
                    elements.authModal.style.display = 'none';
                    elements.appContainer.style.display = 'flex';
                    loadUserData();
                } catch (e) {
                    console.error('Error parsing saved user:', e);
                    localStorage.removeItem('qrisUser');
                    showAuthModal();
                }
            } else {
                showAuthModal();
            }
        }
        
        // Show authentication modal
        function showAuthModal() {
            elements.authModal.style.display = 'flex';
            elements.appContainer.style.display = 'none';
        }
        
        // Handle login
        function handleLogin() {
            const username = elements.usernameInput.value.trim();
            
            if (!username) {
                showToast('Please enter a username', 'error');
                return;
            }
            
            // Simple validation
            if (username.length < 3) {
                showToast('Username must be at least 3 characters', 'error');
                return;
            }
            
            // Create user object
            currentUser = {
                id: generateId(),
                username: username,
                displayName: username,
                email: '',
                phone: '',
                createdAt: new Date().toISOString(),
                lastLogin: new Date().toISOString()
            };
            
            // Save to localStorage
            localStorage.setItem('qrisUser', JSON.stringify(currentUser));
            
            // Hide auth modal and show app
            elements.authModal.style.display = 'none';
            elements.appContainer.style.display = 'flex';
            
            // Load user data
            loadUserData();
            
            showToast(`Welcome, ${username}!`, 'success');
        }
        
        // Load user data
        async function loadUserData() {
            // Show loading
            elements.loadingScreen.style.display = 'flex';
            
            try {
                // Get IP information
                const ipInfo = await getIpInfo();
                
                // Create or update user data
                userData = {
                    profile: {
                        ...currentUser,
                        ip: ipInfo.ip,
                        provider: ipInfo.org,
                        device: navigator.userAgent,
                        lastLogin: new Date().toISOString()
                    },
                    stats: {
                        qrGenerated: Math.floor(Math.random() * 50) + 10,
                        qrValidated: Math.floor(Math.random() * 30) + 5,
                        qrShared: Math.floor(Math.random() * 20) + 3,
                        tracking: Math.floor(Math.random() * 100) + 15
                    },
                    qrHistory: [],
                    settings: {
                        theme: 'light',
                        language: 'id',
                        qrSize: 300,
                        qrFormat: 'png',
                        autoSave: true,
                        autoLogout: 0,
                        passwordProtection: true
                    }
                };
                
                // Update UI with user data
                updateUserInterface();
                
                // Simulate loading delay
                setTimeout(() => {
                    elements.loadingScreen.style.display = 'none';
                }, 1000);
                
            } catch (error) {
                console.error('Error loading user data:', error);
                elements.loadingScreen.style.display = 'none';
                showToast('Error loading user data', 'error');
            }
        }
        
        // Update user interface with user data
        function updateUserInterface() {
            if (!userData) return;
            
            // Update sidebar
            elements.sidebarUserName.textContent = userData.profile.displayName;
            elements.dashboardUserName.textContent = userData.profile.displayName;
            
            // Update stats
            elements.statQrGenerated.textContent = userData.stats.qrGenerated;
            elements.statQrValidated.textContent = userData.stats.qrValidated;
            elements.statQrShared.textContent = userData.stats.qrShared;
            elements.statTracking.textContent = userData.stats.tracking;
            
            // Update profile form
            elements.profileUsername.value = userData.profile.username;
            elements.profileDisplayName.value = userData.profile.displayName;
            elements.profileEmail.value = userData.profile.email;
            elements.profilePhone.value = userData.profile.phone;
            elements.profileIp.value = userData.profile.ip;
            elements.profileProvider.value = userData.profile.provider;
            elements.profileDevice.value = userData.profile.device;
            elements.profileLastLogin.value = formatDate(new Date(userData.profile.lastLogin));
            
            // Update recent activity
            updateRecentActivity();
        }
        
        // Update recent activity list
        function updateRecentActivity() {
            if (!userData || !userData.qrHistory) return;
            
            // Clear existing list
            elements.recentActivityList.innerHTML = '';
            
            // Get recent activities (last 5)
            const recentActivities = userData.qrHistory.slice(-5).reverse();
            
            if (recentActivities.length === 0) {
                elements.recentActivityList.innerHTML = `
                    <li class="activity-item">
                        <div class="activity-icon">
                            <i class="fas fa-info-circle"></i>
                        </div>
                        <div class="activity-content">
                            <div class="activity-title">No recent activity</div>
                            <div class="activity-description">Your QR code activities will appear here</div>
                        </div>
                    </li>
                `;
                return;
            }
            
            // Add activities to list
            recentActivities.forEach(activity => {
                const activityItem = document.createElement('li');
                activityItem.className = 'activity-item';
                
                let icon = 'fa-qrcode';
                let color = '#3b82f6';
                
                if (activity.type === 'validation') {
                    icon = 'fa-check-circle';
                    color = '#10b981';
                } else if (activity.type === 'sharing') {
                    icon = 'fa-share-alt';
                    color = '#8b5cf6';
                }
                
                activityItem.innerHTML = `
                    <div class="activity-icon" style="background-color: ${color}20; color: ${color};">
                        <i class="fas ${icon}"></i>
                    </div>
                    <div class="activity-content">
                        <div class="activity-title">${activity.title}</div>
                        <div class="activity-description">${activity.description}</div>
                        <div class="activity-time">${formatDate(new Date(activity.timestamp))}</div>
                    </div>
                `;
                
                elements.recentActivityList.appendChild(activityItem);
            });
        }
        
        // Handle logout
        function handleLogout() {
            // Clear user data
            currentUser = null;
            userData = null;
            
            // Clear localStorage
            localStorage.removeItem('qrisUser');
            
            // Show auth modal
            showAuthModal();
            
            // Reset form
            elements.usernameInput.value = '';
            
            showToast('You have been logged out', 'info');
        }
        
        // Save profile changes
        function saveProfileChanges() {
            const username = elements.profileUsername.value.trim();
            const displayName = elements.profileDisplayName.value.trim();
            const email = elements.profileEmail.value.trim();
            const phone = elements.profilePhone.value.trim();
            
            // Validate inputs
            if (!username || !displayName) {
                showToast('Username and display name are required', 'error');
                return;
            }
            
            if (email && !isValidEmail(email)) {
                showToast('Please enter a valid email address', 'error');
                return;
            }
            
            if (phone && !isValidPhone(phone)) {
                showToast('Please enter a valid Indonesian phone number', 'error');
                return;
            }
            
            // Update user data
            userData.profile.username = username;
            userData.profile.displayName = displayName;
            
            // If email/phone changed, require OTP verification
            if (email !== userData.profile.email || phone !== userData.profile.phone) {
                // Show OTP section
                elements.otpSection.style.display = 'block';
                showToast('OTP sent to your email/phone', 'info');
                
                // In a real app, you would send OTP here
                // For demo, we'll use a fixed OTP: 123456
                
                // Set up OTP verification
                elements.verifyOtpButton.onclick = function() {
                    const otp = elements.otpInput.value.trim();
                    
                    if (otp === '123456') { // Demo OTP
                        // Update email and phone
                        userData.profile.email = email;
                        userData.profile.phone = phone;
                        
                        // Hide OTP section
                        elements.otpSection.style.display = 'none';
                        
                        // Update UI
                        updateUserInterface();
                        
                        // Close profile modal
                        elements.profileModal.style.display = 'none';
                        
                        showToast('Profile updated successfully', 'success');
                    } else {
                        showToast('Invalid OTP code', 'error');
                    }
                };
                
                return;
            }
            
            // Update UI
            updateUserInterface();
            
            // Close profile modal
            elements.profileModal.style.display = 'none';
            
            showToast('Profile updated successfully', 'success');
        }
        
        // ==================== QRIS FUNCTIONS ====================
        
        // Extract QR data from image
        function extractQrData(imageFile) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    const img = new Image();
                    
                    img.onload = function() {
                        // Create canvas to process image
                        const canvas = document.createElement('canvas');
                        const ctx = canvas.getContext('2d');
                        
                        canvas.width = img.width;
                        canvas.height = img.height;
                        
                        // Draw image to canvas
                        ctx.drawImage(img, 0, 0, img.width, img.height);
                        
                        // Get image data
                        const imageData = ctx.getImageData(0, 0, img.width, img.height);
                        
                        // Try to decode QR code
                        try {
                            const code = jsQR(imageData.data, imageData.width, imageData.height);
                            
                            if (code) {
                                resolve(code.data);
                            } else {
                                reject(new Error('No QR code found in image'));
                            }
                        } catch (error) {
                            reject(error);
                        }
                    };
                    
                    img.onerror = function() {
                        reject(new Error('Failed to load image'));
                    };
                    
                    img.src = e.target.result;
                };
                
                reader.onerror = function() {
                    reject(new Error('Failed to read file'));
                };
                
                reader.readAsDataURL(imageFile);
            });
        }
        
        // Generate QRIS payload
        function generateQrisPayload(merchantName, amount, options = {}) {
            // Basic QRIS payload structure
            let payload = '';
            
            if (amount > 0) {
                // Dynamic QR with amount
                payload = `00020101021126680014ID.CO.QRIS.WWW0215ID10230079153800203UME51440014ID.CO.QRIS.WWW020899990303UME${amount}5204581253033605802ID5914${merchantName.substring(0, 14)}6007INDONESIA61051013062070703A016304`;
            } else {
                // Static QR without amount
                payload = `00020101021126680014ID.CO.QRIS.WWW0215ID10230079153800203UME51440014ID.CO.QRIS.WWW020899990303UME5204581253033605802ID5914${merchantName.substring(0, 14)}6007INDONESIA61051013062070703A016304`;
            }
            
            // Add CRC16 checksum
            const crc = calculateCrc16(payload);
            payload += crc.toString(16).toUpperCase().padStart(4, '0');
            
            return payload;
        }
        
        // Calculate CRC16 checksum for QRIS
        function calculateCrc16(data) {
            let crc = 0xFFFF;
            for (let i = 0; i < data.length; i++) {
                crc ^= data.charCodeAt(i) << 8;
                for (let j = 0; j < 8; j++) {
                    if (crc & 0x8000) {
                        crc = (crc << 1) ^ 0x1021;
                    } else {
                        crc <<= 1;
                    }
                }
            }
            return crc & 0xFFFF;
        }
        
        // Validate QRIS payload
        function validateQrisPayload(payload) {
            // Check if it starts with QRIS prefix
            if (!payload.startsWith('000201')) {
                return { valid: false, reason: 'Invalid QRIS format' };
            }
            
            // Check CRC
            const dataWithoutCrc = payload.substring(0, payload.length - 4);
            const crcProvided = parseInt(payload.substring(payload.length - 4), 16);
            const crcCalculated = calculateCrc16(dataWithoutCrc);
            
            if (crcProvided !== crcCalculated) {
                return { valid: false, reason: 'CRC checksum mismatch' };
            }
            
            // Extract merchant information
            let merchantName = 'Unknown';
            let merchantCity = 'Unknown';
            let amount = 0;
            
            // Parse ID segments
            const idSegments = [];
            let pos = 0;
            
            while (pos < payload.length) {
                const id = payload.substring(pos, pos + 2);
                const length = parseInt(payload.substring(pos + 2, pos + 4), 10);
                const value = payload.substring(pos + 4, pos + 4 + length);
                
                idSegments.push({ id, length, value });
                pos += 4 + length;
                
                if (pos >= payload.length) break;
            }
            
            // Find relevant segments
            for (const segment of idSegments) {
                if (segment.id === '59') {
                    merchantName = segment.value;
                } else if (segment.id === '60') {
                    merchantCity = segment.value;
                } else if (segment.id === '54') {
                    amount = parseFloat(segment.value);
                }
            }
            
            return {
                valid: true,
                merchantName,
                merchantCity,
                amount,
                rawData: payload
            };
        }
        
        // Generate QR code image
        function generateQrCode(data, options = {}) {
            return new Promise((resolve, reject) => {
                const size = options.size || 300;
                const margin = options.margin || 2;
                
                QRCode.toDataURL(data, {
                    width: size,
                    height: size,
                    margin: margin,
                    color: {
                        dark: options.darkColor || '#000000',
                        light: options.lightColor || '#ffffff'
                    }
                }, (err, url) => {
                    if (err) {
                        reject(err);
                    } else {
                        resolve(url);
                    }
                });
            });
        }
        
        // Download QR code
        function downloadQrCode(dataUrl, filename) {
            const link = document.createElement('a');
            link.href = dataUrl;
            link.download = filename;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
        
        // Add to QR history
        function addToQrHistory(qrData) {
            if (!userData.qrHistory) {
                userData.qrHistory = [];
            }
            
            userData.qrHistory.push({
                id: generateId(),
                type: qrData.type || 'generation',
                title: qrData.title || 'QR Code Generated',
                description: qrData.description || '',
                timestamp: new Date().toISOString(),
                data: qrData.data || {}
            });
            
            // Update stats
            if (qrData.type === 'generation') {
                userData.stats.qrGenerated++;
            } else if (qrData.type === 'validation') {
                userData.stats.qrValidated++;
            } else if (qrData.type === 'sharing') {
                userData.stats.qrShared++;
            }
            
            // Update UI
            updateUserInterface();
        }
        
        // ==================== EVENT LISTENERS ====================
        
        // Initialize event listeners
        function initEventListeners() {
            // Login button
            elements.loginButton.addEventListener('click', handleLogin);
            elements.usernameInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') handleLogin();
            });
            
            // Navigation
            navItems.forEach(item => {
                item.addEventListener('click', () => {
                    const page = item.getAttribute('data-page');
                    
                    // Update active nav item
                    navItems.forEach(nav => nav.classList.remove('active'));
                    item.classList.add('active');
                    
                    // Show corresponding page
                    pageContents.forEach(content => {
                        content.style.display = 'none';
                    });
                    
                    document.getElementById(`${page}Page`).style.display = 'block';
                });
            });
            
            // Mobile menu toggle
            elements.mobileMenuButton.addEventListener('click', () => {
                elements.sidebar.classList.toggle('sidebar-open');
            });
            
            // Theme toggle
            elements.themeSwitch.addEventListener('change', toggleTheme);
            elements.themeButton.addEventListener('click', () => {
                elements.themeSwitch.checked = !elements.themeSwitch.checked;
                toggleTheme();
            });
            
            // Ping test
            elements.pingTestButton.addEventListener('click', pingTest);
            
            // User profile
            elements.userProfileButton.addEventListener('click', () => {
                elements.profileModal.style.display = 'flex';
            });
            
            elements.closeProfileModal.addEventListener('click', () => {
                elements.profileModal.style.display = 'none';
            });
            
            elements.cancelProfileChanges.addEventListener('click', () => {
                elements.profileModal.style.display = 'none';
            });
            
            elements.saveProfileChanges.addEventListener('click', saveProfileChanges);
            
            // Logout
            elements.logoutButton.addEventListener('click', handleLogout);
            
            // QR Upload
            elements.qrUploadArea.addEventListener('click', () => {
                elements.qrUploadInput.click();
            });
            
            elements.qrUploadInput.addEventListener('change', (e) => {
                if (e.target.files.length > 0) {
                    const file = e.target.files[0];
                    
                    // Show file name
                    elements.qrUploadArea.querySelector('.file-upload-text').innerHTML = `
                        ${file.name}<br>
                        <span style="font-size: 12px; color: var(--text-muted);">${(file.size / 1024).toFixed(1)} KB</span>
                    `;
                    
                    // Try to extract QR data
                    extractQrData(file).then(data => {
                        elements.qrStringInput.value = data;
                        showToast('QR data extracted successfully', 'success');
                    }).catch(error => {
                        showToast('Failed to extract QR data: ' + error.message, 'error');
                    });
                }
            });
            
            // Extract QR button
            elements.extractQrButton.addEventListener('click', () => {
                if (elements.qrStringInput.value.trim()) {
                    showToast('QR data ready for processing', 'success');
                } else {
                    showToast('Please upload a QR image or enter QR data', 'error');
                }
            });
            
            // Generate QR button
            elements.generateQrButton.addEventListener('click', async () => {
                const merchantName = elements.merchantNameInput.value.trim() || 'Merchant';
                const amount = parseInt(elements.amountInput.value) || 0;
                const notes = elements.notesInput.value.trim();
                
                if (!merchantName) {
                    showToast('Please enter a merchant name', 'error');
                    return;
                }
                
                try {
                    // Generate QRIS payload
                    const payload = generateQrisPayload(merchantName, amount);
                    
                    // Generate QR code
                    const qrImage = await generateQrCode(payload, {
                        size: 300,
                        darkColor: '#000000',
                        lightColor: '#ffffff'
                    });
                    
                    // Display QR code
                    elements.qrPreview.innerHTML = `
                        <img src="${qrImage}" alt="QR Code" style="width: 100%; height: 100%;">
                    `;
                    
                    // Show amount if applicable
                    if (amount > 0) {
                        elements.amountPreview.style.display = 'block';
                        elements.previewAmount.textContent = amount.toLocaleString('id-ID');
                    } else {
                        elements.amountPreview.style.display = 'none';
                    }
                    
                    // Show action buttons
                    elements.qrActionButtons.style.display = 'flex';
                    
                    // Store current QR data
                    currentQrData = {
                        payload,
                        image: qrImage,
                        merchantName,
                        amount,
                        notes,
                        timestamp: new Date().toISOString()
                    };
                    
                    // Show success message
                    elements.conversionResult.style.display = 'flex';
                    elements.conversionMessage.textContent = 'QRIS successfully generated!';
                    
                    // Add to history
                    addToQrHistory({
                        type: 'generation',
                        title: 'QR Code Generated',
                        description: `Merchant: ${merchantName}, Amount: ${amount > 0 ? formatCurrency(amount) : 'Static'}`,
                        data: currentQrData
                    });
                    
                } catch (error) {
                    showToast('Failed to generate QR code: ' + error.message, 'error');
                }
            });
            
            // Download QR button
            elements.downloadQrButton.addEventListener('click', () => {
                if (currentQrData) {
                    downloadQrCode(currentQrData.image, `qris-${currentQrData.merchantName}-${Date.now()}.png`);
                    showToast('QR code downloaded', 'success');
                    
                    // Add to history
                    addToQrHistory({
                        type: 'sharing',
                        title: 'QR Code Downloaded',
                        description: `Merchant: ${currentQrData.merchantName}`,
                        data: currentQrData
                    });
                }
            });
            
            // Share QR button
            elements.shareQrButton.addEventListener('click', () => {
                if (currentQrData) {
                    // For demo purposes, we'll use a simple alert
                    // In a real app, you would use the Web Share API
                    alert(`Share this QR code for ${currentQrData.merchantName}`);
                    showToast('QR code shared', 'success');
                    
                    // Add to history
                    addToQrHistory({
                        type: 'sharing',
                        title: 'QR Code Shared',
                        description: `Merchant: ${currentQrData.merchantName}`,
                        data: currentQrData
                    });
                }
            });
            
            // Track QR button
            elements.trackQrButton.addEventListener('click', () => {
                if (currentQrData) {
                    showToast('QR tracking enabled', 'success');
                    
                    // Add to history
                    addToQrHistory({
                        type: 'tracking',
                        title: 'QR Tracking Enabled',
                        description: `Merchant: ${currentQrData.merchantName}`,
                        data: currentQrData
                    });
                    
                    // Update stats
                    userData.stats.tracking++;
                    updateUserInterface();
                }
            });
            
            // QR Validator upload
            elements.validatorUploadArea.addEventListener('click', () => {
                elements.validatorUploadInput.click();
            });
            
            elements.validatorUploadInput.addEventListener('change', (e) => {
                if (e.target.files.length > 0) {
                    const file = e.target.files[0];
                    
                    // Show file name
                    elements.validatorUploadArea.querySelector('.file-upload-text').innerHTML = `
                        ${file.name}<br>
                        <span style="font-size: 12px; color: var(--text-muted);">${(file.size / 1024).toFixed(1)} KB</span>
                    `;
                    
                    // Try to extract QR data
                    extractQrData(file).then(data => {
                        elements.validatorStringInput.value = data;
                        showToast('QR data extracted successfully', 'success');
                    }).catch(error => {
                        showToast('Failed to extract QR data: ' + error.message, 'error');
                    });
                }
            });
            
            // Validate QR button
            elements.validateQrButton.addEventListener('click', () => {
                const qrData = elements.validatorStringInput.value.trim();
                
                if (!qrData) {
                    showToast('Please upload a QR image or enter QR data', 'error');
                    return;
                }
                
                // Validate QRIS payload
                const validationResult = validateQrisPayload(qrData);
                
                if (validationResult.valid) {
                    elements.validationResults.innerHTML = `
                        <div class="alert alert-success">
                            <i class="fas fa-check-circle success-check"></i>
                            Valid QRIS code
                        </div>
                    `;
                    
                    // Show merchant information
                    elements.merchantInfo.textContent = `Merchant: ${validationResult.merchantName}, City: ${validationResult.merchantCity}`;
                    
                    // Show transaction details
                    if (validationResult.amount > 0) {
                        elements.transactionInfo.textContent = `Amount: ${formatCurrency(validationResult.amount)}`;
                    } else {
                        elements.transactionInfo.textContent = 'Static QR (No amount specified)';
                    }
                    
                    // Hide security warning
                    elements.securityWarning.style.display = 'none';
                    
                    // Add to history
                    addToQrHistory({
                        type: 'validation',
                        title: 'QR Code Validated',
                        description: `Merchant: ${validationResult.merchantName}, Valid: Yes`,
                        data: validationResult
                    });
                    
                } else {
                    elements.validationResults.innerHTML = `
                        <div class="alert alert-error">
                            <i class="fas fa-exclamation-circle"></i>
                            Invalid QRIS code: ${validationResult.reason}
                        </div>
                    `;
                    
                    // Clear merchant and transaction info
                    elements.merchantInfo.textContent = 'No merchant information available';
                    elements.transactionInfo.textContent = 'No transaction details available';
                    
                    // Show security warning
                    elements.securityWarning.style.display = 'flex';
                    elements.warningMessage.textContent = 'This QR code may be invalid or tampered with';
                    
                    // Add to history
                    addToQrHistory({
                        type: 'validation',
                        title: 'QR Code Validation Failed',
                        description: `Reason: ${validationResult.reason}`,
                        data: validationResult
                    });
                }
            });
            
            // QR Generator
            elements.generateNewQrButton.addEventListener('click', async () => {
                const merchantName = elements.genMerchantName.value.trim();
                const merchantCity = elements.genMerchantCity.value.trim();
                const amount = parseInt(elements.genAmount.value) || 0;
                const txType = elements.genTxType.value;
                const notes = elements.genNotes.value.trim();
                
                if (!merchantName || !merchantCity) {
                    showToast('Please enter merchant name and city', 'error');
                    return;
                }
                
                try {
                    // Generate QRIS payload
                    const payload = generateQrisPayload(merchantName, amount);
                    
                    // Generate QR code
                    const qrImage = await generateQrCode(payload, {
                        size: 300,
                        darkColor: '#000000',
                        lightColor: '#ffffff'
                    });
                    
                    // Display QR code
                    elements.genQrPreview.innerHTML = `
                        <img src="${qrImage}" alt="QR Code" style="width: 100%; height: 100%;">
                    `;
                    
                    // Show amount if applicable
                    if (amount > 0) {
                        elements.genAmountPreview.style.display = 'block';
                        elements.genPreviewAmount.textContent = amount.toLocaleString('id-ID');
                    } else {
                        elements.genAmountPreview.style.display = 'none';
                    }
                    
                    // Show action buttons
                    elements.genQrActionButtons.style.display = 'flex';
                    
                    // Store current QR data
                    currentQrData = {
                        payload,
                        image: qrImage,
                        merchantName,
                        merchantCity,
                        amount,
                        txType,
                        notes,
                        timestamp: new Date().toISOString()
                    };
                    
                    showToast('QRIS successfully generated!', 'success');
                    
                    // Add to history
                    addToQrHistory({
                        type: 'generation',
                        title: 'QR Code Generated',
                        description: `Merchant: ${merchantName}, Type: ${txType === 'static' ? 'Static' : 'Dynamic'}`,
                        data: currentQrData
                    });
                    
                } catch (error) {
                    showToast('Failed to generate QR code: ' + error.message, 'error');
                }
            });
            
            // Download generated QR button
            elements.genDownloadQrButton.addEventListener('click', () => {
                if (currentQrData) {
                    downloadQrCode(currentQrData.image, `qris-${currentQrData.merchantName}-${Date.now()}.png`);
                    showToast('QR code downloaded', 'success');
                    
                    // Add to history
                    addToQrHistory({
                        type: 'sharing',
                        title: 'QR Code Downloaded',
                        description: `Merchant: ${currentQrData.merchantName}`,
                        data: currentQrData
                    });
                }
            });
            
            // Share generated QR button
            elements.genShareQrButton.addEventListener('click', () => {
                if (currentQrData) {
                    // For demo purposes, we'll use a simple alert
                    alert(`Share this QR code for ${currentQrData.merchantName}`);
                    showToast('QR code shared', 'success');
                    
                    // Add to history
                    addToQrHistory({
                        type: 'sharing',
                        title: 'QR Code Shared',
                        description: `Merchant: ${currentQrData.merchantName}`,
                        data: currentQrData
                    });
                }
            });
            
            // Save generated QR button
            elements.genSaveQrButton.addEventListener('click', () => {
                if (currentQrData) {
                    showToast('QR code saved to history', 'success');
                    
                    // Add to history
                    addToQrHistory({
                        type: 'generation',
                        title: 'QR Code Saved',
                        description: `Merchant: ${currentQrData.merchantName}`,
                        data: currentQrData
                    });
                }
            });
            
            // Split bill type change
            elements.splitType.addEventListener('change', () => {
                if (elements.splitType.value === 'custom') {
                    elements.customAmountsContainer.style.display = 'block';
                    updateCustomAmountsUI();
                } else {
                    elements.customAmountsContainer.style.display = 'none';
                }
            });
            
            // Calculate split button
            elements.calculateSplitButton.addEventListener('click', () => {
                const totalAmount = parseInt(elements.splitTotalAmount.value);
                const peopleCount = parseInt(elements.splitPeopleCount.value);
                const splitType = elements.splitType.value;
                
                if (!totalAmount || !peopleCount || peopleCount < 2) {
                    showToast('Please enter valid total amount and number of people', 'error');
                    return;
                }
                
                if (splitType === 'equal') {
                    // Equal split
                    const amountPerPerson = Math.ceil(totalAmount / peopleCount);
                    
                    elements.splitResults.innerHTML = `
                        <div class="alert alert-success">
                            <i class="fas fa-check-circle success-check"></i>
                            Split calculation complete
                        </div>
                        <div style="margin-top: 15px;">
                            <div style="font-weight: 500; margin-bottom: 10px;">Split Details:</div>
                            <div>Total Amount: <strong>${formatCurrency(totalAmount)}</strong></div>
                            <div>Number of People: <strong>${peopleCount}</strong></div>
                            <div>Amount per Person: <strong>${formatCurrency(amountPerPerson)}</strong></div>
                        </div>
                    `;
                    
                    // Store split data
                    splitBillData = {
                        totalAmount,
                        peopleCount,
                        amounts: Array(peopleCount).fill(amountPerPerson),
                        type: 'equal'
                    };
                    
                    // Enable generate button
                    elements.generateSplitQrButton.disabled = false;
                    
                } else {
                    // Custom split
                    const customAmounts = [];
                    let totalCustomAmount = 0;
                    
                    // Get all custom amount inputs
                    const amountInputs = document.querySelectorAll('.custom-amount-input');
                    
                    for (const input of amountInputs) {
                        const amount = parseInt(input.value) || 0;
                        customAmounts.push(amount);
                        totalCustomAmount += amount;
                    }
                    
                    if (totalCustomAmount !== totalAmount) {
                        showToast(`Custom amounts total (${formatCurrency(totalCustomAmount)}) must equal total amount (${formatCurrency(totalAmount)})`, 'error');
                        return;
                    }
                    
                    elements.splitResults.innerHTML = `
                        <div class="alert alert-success">
                            <i class="fas fa-check-circle success-check"></i>
                            Split calculation complete
                        </div>
                        <div style="margin-top: 15px;">
                            <div style="font-weight: 500; margin-bottom: 10px;">Split Details:</div>
                            <div>Total Amount: <strong>${formatCurrency(totalAmount)}</strong></div>
                            <div>Number of People: <strong>${peopleCount}</strong></div>
                            <div>Custom amounts configured</div>
                        </div>
                    `;
                    
                    // Store split data
                    splitBillData = {
                        totalAmount,
                        peopleCount,
                        amounts: customAmounts,
                        type: 'custom'
                    };
                    
                    // Enable generate button
                    elements.generateSplitQrButton.disabled = false;
                }
            });
            
            // Generate split QR button
            elements.generateSplitQrButton.addEventListener('click', async () => {
                if (!splitBillData) return;
                
                const merchantName = elements.splitMerchantName.value.trim() || 'Split Bill';
                
                try {
                    // Clear previous QR codes
                    elements.splitQrContainer.innerHTML = '';
                    
                    // Generate QR codes for each amount
                    for (let i = 0; i < splitBillData.peopleCount; i++) {
                        const amount = splitBillData.amounts[i];
                        
                        // Generate QRIS payload
                        const payload = generateQrisPayload(merchantName, amount);
                        
                        // Generate QR code
                        const qrImage = await generateQrCode(payload, {
                            size: 200,
                            darkColor: '#000000',
                            lightColor: '#ffffff'
                        });
                        
                        // Create QR card
                        const qrCard = document.createElement('div');
                        qrCard.className = 'split-qr-card';
                        qrCard.innerHTML = `
                            <div class="split-qr-title">Person ${i + 1}</div>
                            <div class="split-qr-amount">${formatCurrency(amount)}</div>
                            <img src="${qrImage}" alt="QR Code for ${formatCurrency(amount)}" style="width: 100%;">
                            <button class="button button-small download-split-qr" data-index="${i}">
                                <i class="fas fa-download"></i> Download
                            </button>
                        `;
                        
                        elements.splitQrContainer.appendChild(qrCard);
                    }
                    
                    // Show QR section
                    elements.splitQrSection.style.display = 'block';
                    
                    // Add download event listeners
                    document.querySelectorAll('.download-split-qr').forEach(button => {
                        button.addEventListener('click', (e) => {
                            const index = parseInt(e.target.getAttribute('data-index'));
                            const amount = splitBillData.amounts[index];
                            downloadQrCode(qrImage, `split-qr-${index+1}-${amount}-${Date.now()}.png`);
                            showToast(`QR code for person ${index+1} downloaded`, 'success');
                        });
                    });
                    
                    // Add to history
                    addToQrHistory({
                        type: 'generation',
                        title: 'Split Bill QR Generated',
                        description: `Merchant: ${merchantName}, People: ${splitBillData.peopleCount}, Total: ${formatCurrency(splitBillData.totalAmount)}`,
                        data: splitBillData
                    });
                    
                } catch (error) {
                    showToast('Failed to generate split QR codes: ' + error.message, 'error');
                }
            });
            
            // Download all split QR button
            elements.downloadAllSplitQrButton.addEventListener('click', () => {
                showToast('This would download all QR codes in a real application', 'info');
            });
            
            // Share all split QR button
            elements.shareAllSplitQrButton.addEventListener('click', () => {
                showToast('This would share all QR codes in a real application', 'info');
            });
            
            // Backup data button
            elements.backupDataButton.addEventListener('click', () => {
                const password = elements.backupPassword.value;
                const confirmPassword = elements.backupPasswordConfirm.value;
                
                if (!password) {
                    showToast('Please enter a backup password', 'error');
                    return;
                }
                
                if (password !== confirmPassword) {
                    showToast('Passwords do not match', 'error');
                    return;
                }
                
                // In a real app, you would encrypt and backup the data
                showToast('Backup functionality would save your data in a real application', 'info');
            });
            
            // Restore data button
            elements.restoreDataButton.addEventListener('click', () => {
                const password = elements.restorePassword.value;
                
                if (!password) {
                    showToast('Please enter your backup password', 'error');
                    return;
                }
                
                // In a real app, you would decrypt and restore the data
                showToast('Restore functionality would load your data in a real application', 'info');
            });
            
            // Clear history button
            elements.clearHistoryButton.addEventListener('click', () => {
                if (confirm('Are you sure you want to clear all history? This cannot be undone.')) {
                    userData.qrHistory = [];
                    updateRecentActivity();
                    showToast('History cleared', 'success');
                }
            });
            
            // Reset settings button
            elements.resetSettingsButton.addEventListener('click', () => {
                if (confirm('Are you sure you want to reset all settings to default?')) {
                    userData.settings = {
                        theme: 'light',
                        language: 'id',
                        qrSize: 300,
                        qrFormat: 'png',
                        autoSave: true,
                        autoLogout: 0,
                        passwordProtection: true
                    };
                    
                    // Update UI
                    elements.settingsThemeSwitch.checked = false;
                    elements.languageSelect.value = 'id';
                    elements.qrSizeSelect.value = '300';
                    elements.qrFormatSelect.value = 'png';
                    elements.autoSaveSwitch.checked = true;
                    elements.autoLogoutSelect.value = '0';
                    elements.passwordProtectionSwitch.checked = true;
                    
                    showToast('Settings reset to default', 'success');
                }
            });
            
            // Expiry select change
            elements.expirySelect.addEventListener('change', () => {
                if (elements.expirySelect.value === 'custom') {
                    elements.customExpiryGroup.style.display = 'block';
                } else {
                    elements.customExpiryGroup.style.display = 'none';
                }
            });
            
            // People count change for split bill
            elements.splitPeopleCount.addEventListener('change', updateCustomAmountsUI);
        }
        
        // Update custom amounts UI
        function updateCustomAmountsUI() {
            if (elements.splitType.value !== 'custom') return;
            
            const peopleCount = parseInt(elements.splitPeopleCount.value) || 2;
            
            // Clear existing inputs
            elements.customAmountsList.innerHTML = '';
            
            // Create inputs for each person
            for (let i = 0; i < peopleCount; i++) {
                const inputGroup = document.createElement('div');
                inputGroup.className = 'input-group';
                inputGroup.style.marginBottom = '10px';
                
                inputGroup.innerHTML = `
                    <label class="input-label">Amount for Person ${i + 1}</label>
                    <div class="input-wrapper">
                        <input type="number" class="input-field custom-amount-input" placeholder="Enter amount" data-index="${i}">
                        <div class="currency-preview">IDR</div>
                    </div>
                `;
                
                elements.customAmountsList.appendChild(inputGroup);
            }
        }
        
        // Toggle theme
        function toggleTheme() {
            const isDarkMode = elements.themeSwitch.checked;
            
            if (isDarkMode) {
                document.documentElement.setAttribute('data-theme', 'dark');
                localStorage.setItem('theme', 'dark');
            } else {
                document.documentElement.setAttribute('data-theme', 'light');
                localStorage.setItem('theme', 'light');
            }
        }
        
        // ==================== INITIALIZATION ====================
        
        // Initialize the application
        function init() {
            // Check saved theme
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme === 'dark') {
                elements.themeSwitch.checked = true;
                document.documentElement.setAttribute('data-theme', 'dark');
            }
            
            // Initialize auth
            initAuth();
            
            // Initialize event listeners
            initEventListeners();
            
            // Hide loading screen after initialization
            setTimeout(() => {
                elements.loadingScreen.style.display = 'none';
            }, 1500);
        }
        
        // Start the application
        window.addEventListener('load', init);
    </script>
</body>
</html>
